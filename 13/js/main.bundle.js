(()=>{"use strict";const e=document.querySelector("#card").content.querySelector(".popup"),t={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"},o=(e,t)=>t[e%100>4&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]],r=document.querySelector(".map__filters"),n=r.querySelectorAll("select"),a=r.querySelector("#housing-type"),s=r.querySelector("#housing-price"),c=r.querySelector("#housing-rooms"),l=r.querySelector("#housing-guests"),i=r.querySelector("#housing-features"),d=()=>{r.classList.add("map__filters--disabled"),n.forEach((e=>{e.disabled=!0})),i.disabled=!0};d();const u=e=>{const t="any"===a.value||a.value===e.offer.type,o="any"===c.value||+c.value===e.offer.rooms,r="any"===l.value||+l.value===e.offer.guests,n=(e=>{switch(s.value){case"low":return e.offer.price<1e4;case"middle":return e.offer.price>=1e4&&e.offer.price<=5e4;case"high":return e.offer.price>5e4;case"any":return!0}})(e),d=(e=>{const t=i.querySelectorAll("input:checked");return Array.from(t).every((t=>e.offer.features.includes(t.value)))})(e);return t&&o&&r&&n&&d},p=document.querySelector("#error").content.querySelector(".error"),m=document.querySelector("#success").content.querySelector(".success"),y=document.querySelector("main"),g=e=>{const t=t=>{(e=>"Escape"===e.key||"Esc"===e.key)(t)&&(t.preventDefault(),o(e))},o=()=>{e.remove(),document.removeEventListener("keydown",t)};y.append(e),document.addEventListener("keydown",t),e.addEventListener("click",(()=>{o(e)}))},v=()=>{const e=m.cloneNode(!0);C.reset(),g(e)},h=()=>{const e=p.cloneNode(!0);g(e)},f=["gif","jpg","jpeg","png"],S=document.querySelector(".ad-form-header__input"),q=document.querySelector(".ad-form-header__preview img"),E=document.querySelector(".ad-form__input"),b=document.querySelector(".ad-form__photo"),x=(e,t)=>{const o=e.files[0],r=o.name.toLowerCase();if(f.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{t.src=e.result})),e.readAsDataURL(o)}};S.addEventListener("change",(()=>x(S,q))),E.addEventListener("change",(()=>{const e=document.createElement("img");e.width=`${b.offsetWidth}`,e.height=`${b.offsetHeight}`,e.alt="Фотография жилья в аренду",b.innerHTML="",b.append(e),x(E,e)}));const C=document.querySelector(".ad-form"),$=C.querySelector("#title"),k=C.querySelector("#type"),w=C.querySelector("#price"),T=C.querySelector("#timein"),V=C.querySelector("#timeout"),A=C.querySelectorAll("fieldset"),M=C.querySelector("#address"),D=C.querySelector("#room_number"),F=C.querySelector("#capacity"),j={bungalow:0,flat:1e3,house:5e3,palace:1e4},z={1:["1"],2:["1","2"],3:["1","2","3"],100:["0"]};C.classList.add("ad-form--disabled"),A.forEach((e=>{e.disabled=!0})),$.addEventListener("invalid",(()=>{$.validity.tooShort?$.setCustomValidity(`Минимальное количество символов: ${$.minLength}`):$.validity.tooLong?$.setCustomValidity(`Максимальное количество символов: ${$.maxLength}`):$.validity.valueMissing?$.setCustomValidity("Обязательное поле"):$.setCustomValidity("")})),M.readOnly=!0,k.addEventListener("change",(()=>{const e=j[k.value];w.min=e,w.placeholder=e})),w.addEventListener("invalid",(()=>{w.validity.rangeUnderflow?w.setCustomValidity(`Минимальная цена: ${w.min}`):w.validity.tooLong?$.setCustomValidity(`Максимальная цена: ${w.max}`):w.validity.valueMissing?w.setCustomValidity("Обязательное поле"):w.setCustomValidity("")}));const H=()=>{for(let e of F.options)e.disabled=!z[D.value].includes(e.value);F.value=z[D.value].includes(F.value)?F.value:z[D.value][0]};H(),D.addEventListener("change",(()=>{H()})),T.addEventListener("change",(()=>{V.value=T.value})),V.addEventListener("change",(()=>{T.value=V.value})),C.addEventListener("submit",(e=>{var t,o,r;e.preventDefault(),t=v,o=h,r=new FormData(e.target),fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:r}).then((e=>{e.ok?t():o()})).catch((()=>{o()}))})),C.addEventListener("reset",(()=>{r.reset(),P.setLatLng(N),q.src="img/muffin-grey.svg",b.innerHTML="",setTimeout((()=>{H(),M.value=`${N.lat}, ${N.lng}`}),0)}));const N={lat:"35.68951",lng:"139.69201"},U=L.map("map-canvas").on("load",(()=>{r.classList.remove("map__filters--disabled"),n.forEach((e=>{e.disabled=!1})),i.disabled=!1,C.classList.remove("ad-form--disabled"),A.forEach((e=>{e.disabled=!1})),M.value=`${N.lat}, ${N.lng}`})).setView({lat:N.lat,lng:N.lng},10),O=L.icon({iconUrl:"./img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),P=L.marker({lat:N.lat,lng:N.lng},{draggable:!0,icon:O}),R=L.icon({iconUrl:"./img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(U),P.addTo(U),P.on("moveend",(e=>{M.value=`${e.target.getLatLng().lat.toFixed(5)}, ${e.target.getLatLng().lng.toFixed(5)}`}));let W=[];const I=r=>{W.forEach((e=>e.remove())),r.filter(u).slice(0,10).forEach((r=>{const n=L.marker({lat:r.location.lat,lng:r.location.lng},{icon:R});n.addTo(U).bindPopup((({author:r,offer:n})=>{const a=e.cloneNode(!0);a.querySelector(".popup__title").textContent=n.title,a.querySelector(".popup__text--address").textContent=n.address,a.querySelector(".popup__text--price").textContent=`${n.price} ₽/ночь`,a.querySelector(".popup__type").textContent=t[n.type],a.querySelector(".popup__text--capacity").textContent=`${n.rooms} ${o(n.rooms,["комната","комнаты","комнат"])} для ${n.guests} ${o(n.guests,["гостя","гостей","гостей"])}`,a.querySelector(".popup__text--time").textContent=`Заезд после ${n.checkin}, выезд до ${n.checkout}`;const s=a.querySelector(".popup__features");s.innerHTML="",s.appendChild((e=>{const t=document.createDocumentFragment();return e.forEach((e=>{const o=document.createElement("li"),r=`popup__feature--${e}`;o.classList.add(r),o.classList.add("popup__feature"),t.appendChild(o)})),t})(n.features)),a.querySelector(".popup__description").textContent=n.description;const c=a.querySelector(".popup__photos"),l=a.querySelector(".popup__photo");return c.innerHTML="",c.appendChild(((e,t)=>{const o=document.createDocumentFragment();return e.forEach((e=>{const r=t.cloneNode(!0);r.src=e,o.appendChild(r)})),o})(n.photos,l)),a.querySelector(".popup__avatar").src=r.avatar,a})(r)),W.push(n)}))};var B,G;B=e=>{var t;I(e),t=()=>I(e),r.addEventListener("reset",(()=>{setTimeout((()=>{t()}),0)})),(e=>{r.addEventListener("change",(()=>{e()}))})(_.debounce((()=>I(e)),500))},G=e=>{const t=document.createElement("div");t.style.zIndex="100",t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.right="0",t.style.padding="10px 3px",t.style.fontSize="20px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),d(),setTimeout((()=>{t.remove()}),5e3)},fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((e=>{B(e)})).catch((()=>{G("Не удалось получить данные с сервера, попробуйте перезагрузить страницу")}))})();
//# sourceMappingURL=main.bundle.js.map