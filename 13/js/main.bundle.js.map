{"version":3,"sources":["webpack://keksobooking/./source/js/popup.js","webpack://keksobooking/./source/js/filter.js","webpack://keksobooking/./source/js/messages.js","webpack://keksobooking/./source/js/photos.js","webpack://keksobooking/./source/js/form.js","webpack://keksobooking/./source/js/api.js","webpack://keksobooking/./source/js/map.js"],"names":["similarCardTemplate","document","querySelector","content","typeDictionary","flat","bungalow","house","palace","declineWord","number","words","filter","selects","querySelectorAll","typeSelect","priceSelect","roomsSelect","guestsSelect","featuresFieldset","disableFilter","classList","add","forEach","select","disabled","filterAds","data","filterByType","value","offer","type","filterByRooms","rooms","filterByGuests","guests","filterByPrice","price","getFilterByPrice","filterByFeatures","checkedFeatures","Array","from","every","input","features","includes","getFilterByFeatures","errorTemplate","successTemplate","main","createModal","onModalEscKeydown","evt","key","isEscEvent","preventDefault","closeModal","remove","removeEventListener","append","addEventListener","showSuccessMessage","successMessage","cloneNode","adForm","reset","showErrorMessage","errorMessage","FILE_TYPES","avatarFileChooser","avatarPreview","photoFileChooser","photoPreview","readImage","chooser","preview","file","files","fileName","name","toLowerCase","some","endsWith","reader","FileReader","src","result","readAsDataURL","newPhotoPreview","createElement","width","offsetWidth","height","offsetHeight","alt","innerHTML","title","checkInTime","checkOutTime","fieldsets","address","roomNumber","capacity","accomodationPrice","roomsCapacity","fieldset","validity","tooShort","setCustomValidity","minLength","tooLong","maxLength","valueMissing","readOnly","minPrice","min","placeholder","rangeUnderflow","max","getRoomCapacity","option","options","onSuccess","onFail","body","FormData","target","fetch","method","then","response","ok","catch","mainPin","setLatLng","initialCoordinates","setTimeout","lat","lng","map","L","on","setView","mainPinIcon","icon","iconUrl","iconSize","iconAnchor","marker","draggable","smallPinIcon","tileLayer","attribution","addTo","getLatLng","toFixed","smallPins","createSmallPins","similarAds","pin","slice","ad","smallPin","location","bindPopup","author","similarCardElement","textContent","checkin","checkout","cardFeatures","appendChild","featuresFragment","createDocumentFragment","feature","newElement","newElementClass","createFeaturesList","description","cardPhotos","cardPhotoTemplate","photos","template","photosFragment","photo","createPhotosList","avatar","createSimilarCard","push","ads","cb","setFilterChange","_","debounce","message","alertContainer","style","zIndex","position","left","top","right","padding","fontSize","textAlign","backgroundColor","json"],"mappings":"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","file":"main.bundle.js","sourcesContent":["const similarCardTemplate = document.querySelector('#card').content.querySelector('.popup');\n\nconst typeDictionary = {\n  flat: 'Квартира',\n  bungalow: 'Бунгало',\n  house: 'Дом',\n  palace: 'Дворец',\n};\n\n// Функция, возвращаюшая список удобств объекта размещения в виде элементов HTML-списка\nconst createFeaturesList = (features) => {\n  const featuresFragment = document.createDocumentFragment();\n  features.forEach((feature) => {\n    const newElement = document.createElement('li');\n    const newElementClass = `popup__feature--${feature}`;\n    newElement.classList.add(newElementClass);\n    newElement.classList.add('popup__feature');\n    featuresFragment.appendChild(newElement);\n  })\n  return featuresFragment;\n};\n\n// Функция, возвращаюшая фотографии объекта размещения в виде элементов HTML\nconst createPhotosList = (photos, template) => {\n  const photosFragment = document.createDocumentFragment();\n  photos.forEach((photo) => {\n    const newElement = template.cloneNode(true);\n    newElement.src = photo;\n    photosFragment.appendChild(newElement);\n  })\n  return photosFragment;\n};\n\n// Функция, определяющая окончание слова в зависимости от числительного (подсмотрела решение здесь - https://realadmin.ru/coding/sklonenie-na-javascript.html)\nconst declineWord = (number, words) => {\n  return words[(number % 100 > 4 && number % 100 < 20) ? 2 : [2, 0, 1, 1, 1, 2][(number % 10 < 5) ? number % 10 : 5]];\n};\n\nconst createSimilarCard = ({author, offer}) => {\n  const similarCardElement = similarCardTemplate.cloneNode(true);\n  similarCardElement.querySelector('.popup__title').textContent = offer.title;\n  similarCardElement.querySelector('.popup__text--address').textContent = offer.address;\n  similarCardElement.querySelector('.popup__text--price').textContent = `${offer.price} ₽/ночь`;\n  similarCardElement.querySelector('.popup__type').textContent = typeDictionary[offer.type];\n  similarCardElement.querySelector('.popup__text--capacity').textContent = `${offer.rooms} ${declineWord(offer.rooms, ['комната', 'комнаты', 'комнат'])} для ${offer.guests} ${declineWord(offer.guests, ['гостя', 'гостей', 'гостей'])}`;\n  similarCardElement.querySelector('.popup__text--time').textContent = `Заезд после ${offer.checkin}, выезд до ${offer.checkout}`;\n\n  const cardFeatures = similarCardElement.querySelector('.popup__features');\n  cardFeatures.innerHTML = '';\n  cardFeatures.appendChild(createFeaturesList(offer.features));\n  similarCardElement.querySelector('.popup__description').textContent = offer.description;\n\n  const cardPhotos = similarCardElement.querySelector('.popup__photos');\n  const cardPhotoTemplate = similarCardElement.querySelector('.popup__photo');\n  cardPhotos.innerHTML = '';\n  cardPhotos.appendChild(createPhotosList(offer.photos, cardPhotoTemplate));\n  similarCardElement.querySelector('.popup__avatar').src = author.avatar;\n\n  return similarCardElement;\n};\n\nexport {createSimilarCard};\n","const filter = document.querySelector('.map__filters');\n\nconst selects = filter.querySelectorAll('select');\n\nconst typeSelect = filter.querySelector('#housing-type');\n\nconst priceSelect = filter.querySelector('#housing-price');\n\nconst roomsSelect = filter.querySelector('#housing-rooms');\n\nconst guestsSelect = filter.querySelector('#housing-guests');\n\nconst featuresFieldset = filter.querySelector('#housing-features');\n\nconst disableFilter = () => {\n  filter.classList.add('map__filters--disabled');\n  selects.forEach((select) => {\n    select.disabled = true;\n  });\n  featuresFieldset.disabled = true;\n};\n\ndisableFilter();\n\nconst enableFilter = () => {\n  filter.classList.remove('map__filters--disabled');\n  selects.forEach((select) => {\n    select.disabled = false;\n  });\n  featuresFieldset.disabled = false;\n};\n\nconst getFilterByPrice = (data) => {\n  const LOW_PRICE = 10000;\n\n  const HIGH_PRICE = 50000;\n\n  switch (priceSelect.value) {\n    case 'low':\n      return data.offer.price < LOW_PRICE;\n    case 'middle':\n      return data.offer.price >= LOW_PRICE && data.offer.price <= HIGH_PRICE;\n    case 'high':\n      return data.offer.price > HIGH_PRICE;\n    case 'any':\n      return true;\n  }\n};\n\nconst getFilterByFeatures = (data) => {\n  const checkedFeatures = featuresFieldset.querySelectorAll('input:checked');\n  return Array.from(checkedFeatures).every((input) => {\n    return data.offer.features.includes(input.value);\n  });\n};\n\nconst filterAds = (data) => {\n  const filterByType = typeSelect.value === 'any' || typeSelect.value === data.offer.type;\n\n  const filterByRooms = roomsSelect.value === 'any' || +roomsSelect.value === data.offer.rooms;\n\n  const filterByGuests = guestsSelect.value === 'any' || +guestsSelect.value === data.offer.guests;\n\n  const filterByPrice = getFilterByPrice(data);\n\n  const filterByFeatures = getFilterByFeatures(data);\n\n  return filterByType && filterByRooms && filterByGuests && filterByPrice && filterByFeatures;\n};\n\nconst setFilterChange = (cb) => {\n  filter.addEventListener('change', () => {\n    cb();\n  });\n};\n\nconst setFilterReset = (cb) => {\n  filter.addEventListener('reset', () => {\n    setTimeout(() => {\n      cb();\n    }, 0);\n  });\n};\n\nexport {enableFilter, disableFilter, filter, filterAds, setFilterChange, setFilterReset};\n","import {disableFilter} from './filter.js';\nimport {adForm} from './form.js';\n\nconst ALERT_SHOW_TIME = 5000;\n\nconst errorTemplate = document.querySelector('#error').content.querySelector('.error');\n\nconst successTemplate = document.querySelector('#success').content.querySelector('.success');\n\nconst main = document.querySelector('main');\n\nconst isEscEvent = (evt) => {\n  return evt.key === 'Escape' || evt.key === 'Esc';\n};\n\n// Функция, создающая модальное окно\nconst createModal = (type) => {\n\n  const onModalEscKeydown = (evt) => {\n    if (isEscEvent(evt)) {\n      evt.preventDefault();\n      closeModal(type);\n    }\n  };\n\n  const closeModal = () => {\n    type.remove();\n    document.removeEventListener('keydown', onModalEscKeydown);\n  };\n\n  main.append(type);\n\n  document.addEventListener('keydown', onModalEscKeydown);\n\n  type.addEventListener('click', () => {\n    closeModal(type);\n  });\n};\n\n// Функция, показывающая окно с информацией об успешной отправке формы\nconst showSuccessMessage = () => {\n  const successMessage = successTemplate.cloneNode(true);\n  adForm.reset();\n  createModal(successMessage);\n};\n\n// Функция, показывающая окно с информацией об ошибке при отправке формы\nconst showErrorMessage = () => {\n  const errorMessage = errorTemplate.cloneNode(true);\n  createModal(errorMessage);\n};\n\n// Функция, показывающая предупреждение об ошибке запроса\nconst showAlert = (message) => {\n  const alertContainer = document.createElement('div');\n  alertContainer.style.zIndex = '100';\n  alertContainer.style.position = 'absolute';\n  alertContainer.style.left = '0';\n  alertContainer.style.top = '0';\n  alertContainer.style.right = '0';\n  alertContainer.style.padding = '10px 3px';\n  alertContainer.style.fontSize = '20px';\n  alertContainer.style.textAlign = 'center';\n  alertContainer.style.backgroundColor = 'red';\n\n  alertContainer.textContent = message;\n\n  document.body.append(alertContainer);\n\n  disableFilter();\n\n  setTimeout(() => {\n    alertContainer.remove();\n  }, ALERT_SHOW_TIME);\n};\n\nexport {showAlert, showErrorMessage, showSuccessMessage};\n","const FILE_TYPES = ['gif', 'jpg', 'jpeg', 'png'];\n\nconst AVATAR_DEFAULT_PICTURE = 'img/muffin-grey.svg';\n\nconst avatarFileChooser = document.querySelector('.ad-form-header__input');\n\nconst avatarPreview = document.querySelector('.ad-form-header__preview img');\n\nconst photoFileChooser = document.querySelector('.ad-form__input');\n\nconst photoPreview = document.querySelector('.ad-form__photo');\n\n\nconst readImage = (chooser, preview) => {\n  const file = chooser.files[0];\n  const fileName = file.name.toLowerCase();\n\n  const matches = FILE_TYPES.some((type) => {\n    return fileName.endsWith(type);\n  });\n\n  if (matches) {\n    const reader = new FileReader();\n\n    reader.addEventListener('load', () => {\n      preview.src = reader.result;\n    });\n\n    reader.readAsDataURL(file);\n  }\n};\n\nconst createNewPhotoPreview = () => {\n  const newPhotoPreview = document.createElement('img');\n  newPhotoPreview.width = `${photoPreview.offsetWidth}`;\n  newPhotoPreview.height = `${photoPreview.offsetHeight}`;\n  newPhotoPreview.alt = 'Фотография жилья в аренду';\n  photoPreview.innerHTML = '';\n  photoPreview.append(newPhotoPreview);\n  readImage(photoFileChooser, newPhotoPreview);\n};\n\navatarFileChooser.addEventListener('change', () => readImage(avatarFileChooser, avatarPreview));\n\nphotoFileChooser.addEventListener('change', createNewPhotoPreview);\n\nconst resetPhotoPreview = () => {\n  avatarPreview.src = AVATAR_DEFAULT_PICTURE;\n  photoPreview.innerHTML = '';\n};\n\nexport {resetPhotoPreview};\n","import {showErrorMessage, showSuccessMessage} from './messages.js';\nimport {sendData} from './api.js';\nimport {initialCoordinates, mainPin} from './map.js';\nimport {filter} from './filter.js';\nimport {resetPhotoPreview} from './photos.js';\n\nconst adForm = document.querySelector('.ad-form');\n\nconst title = adForm.querySelector('#title');\n\nconst type = adForm.querySelector('#type');\n\nconst price = adForm.querySelector('#price');\n\nconst checkInTime = adForm.querySelector('#timein');\n\nconst checkOutTime = adForm.querySelector('#timeout');\n\nconst fieldsets = adForm.querySelectorAll('fieldset');\n\nconst address = adForm.querySelector('#address');\n\nconst roomNumber = adForm.querySelector('#room_number');\n\nconst capacity = adForm.querySelector('#capacity');\n\n\nconst accomodationPrice = {\n  bungalow: 0,\n  flat: 1000,\n  house: 5000,\n  palace: 10000,\n};\n\nconst roomsCapacity = {\n  '1': ['1'],\n  '2': ['1', '2'],\n  '3': ['1', '2', '3'],\n  '100': ['0'],\n};\n\nconst disableForm = () => {\n  adForm.classList.add('ad-form--disabled');\n  fieldsets.forEach((fieldset) => {\n    fieldset.disabled = true;\n  });\n};\n\nconst enableForm = () => {\n  adForm.classList.remove('ad-form--disabled');\n  fieldsets.forEach((fieldset) => {\n    fieldset.disabled = false;\n  });\n};\n\ndisableForm();\n\ntitle.addEventListener('invalid', () => {\n  if (title.validity.tooShort) {\n    title.setCustomValidity(`Минимальное количество символов: ${title.minLength}`);\n  } else if (title.validity.tooLong) {\n    title.setCustomValidity(`Максимальное количество символов: ${title.maxLength}`);\n  } else if (title.validity.valueMissing) {\n    title.setCustomValidity('Обязательное поле');\n  } else {\n    title.setCustomValidity('');\n  }\n});\n\naddress.readOnly = true;\n\ntype.addEventListener('change', () => {\n  const minPrice = accomodationPrice[type.value];\n  price.min = minPrice;\n  price.placeholder = minPrice;\n});\n\nprice.addEventListener('invalid', () => {\n  if (price.validity.rangeUnderflow) {\n    price.setCustomValidity(`Минимальная цена: ${price.min}`);\n  } else if (price.validity.tooLong) {\n    title.setCustomValidity(`Максимальная цена: ${price.max}`);\n  } else if (price.validity.valueMissing) {\n    price.setCustomValidity('Обязательное поле');\n  } else {\n    price.setCustomValidity('');\n  }\n});\n\nconst getRoomCapacity = () => {\n  for (let option of capacity.options) {\n    option.disabled = !roomsCapacity[roomNumber.value].includes(option.value);\n  }\n  capacity.value = roomsCapacity[roomNumber.value].includes(capacity.value) ? capacity.value : roomsCapacity[roomNumber.value][0];\n};\n\ngetRoomCapacity();\n\nroomNumber.addEventListener('change', () => {\n  getRoomCapacity();\n});\n\ncheckInTime.addEventListener('change', () => {\n  checkOutTime.value = checkInTime.value;\n});\n\ncheckOutTime.addEventListener('change', () => {\n  checkInTime.value = checkOutTime.value;\n});\n\nadForm.addEventListener('submit', (evt) => {\n  evt.preventDefault();\n  sendData(\n    showSuccessMessage,\n    showErrorMessage,\n    new FormData(evt.target),\n  );\n});\n\nadForm.addEventListener('reset', () => {\n  filter.reset();\n  mainPin.setLatLng(initialCoordinates);\n  resetPhotoPreview();\n  setTimeout(() => {\n    getRoomCapacity();\n    address.value = `${initialCoordinates.lat}, ${initialCoordinates.lng}`;\n  }, 0)\n});\n\nexport {enableForm, address, adForm};\n","const getData = (onSuccess, onFail) => {\n  fetch('https://22.javascript.pages.academy/keksobooking/data')\n    .then((response) => response.json())\n    .then((ads) => {\n      onSuccess(ads);\n    })\n    .catch(() => {\n      onFail('Не удалось получить данные с сервера, попробуйте перезагрузить страницу');\n    });\n};\n\nconst sendData = (onSuccess, onFail, body) => {\n  fetch(\n    'https://22.javascript.pages.academy/keksobooking',\n    {\n      method: 'POST',\n      body,\n    },\n  )\n    .then((response) => {\n      if (response.ok) {\n        onSuccess();\n      } else {\n        onFail();\n      }\n    })\n    .catch(() => {\n      onFail();\n    });\n};\n\nexport {getData, sendData};\n","/* global L:readonly */\n/* global _:readonly */\n\nimport {enableFilter, setFilterChange, filterAds, setFilterReset} from './filter.js';\nimport {enableForm, address} from './form.js';\nimport {createSimilarCard} from './popup.js';\nimport {getData} from './api.js';\nimport {showAlert} from './messages.js';\n\nconst SIMILAR_ADS_COUNT = 10;\n\nconst CREATE_PINS_DELAY = 500;\n\nconst initialCoordinates = {\n  lat: '35.68951',\n  lng: '139.69201',\n};\n\nconst map = L.map('map-canvas')\n  .on('load', () => {\n    enableFilter();\n    enableForm();\n    address.value = `${initialCoordinates.lat}, ${initialCoordinates.lng}`;\n  })\n  .setView({\n    lat: initialCoordinates.lat,\n    lng: initialCoordinates.lng,\n  }, 10);\n\nconst mainPinIcon = L.icon({\n  iconUrl: './img/main-pin.svg',\n  iconSize: [52, 52],\n  iconAnchor: [26, 52],\n});\n\nconst mainPin = L.marker(\n  {\n    lat: initialCoordinates.lat,\n    lng: initialCoordinates.lng,\n  },\n  {\n    draggable: true,\n    icon: mainPinIcon,\n  },\n);\n\nconst smallPinIcon = L.icon({\n  iconUrl: './img/pin.svg',\n  iconSize: [40, 40],\n  iconAnchor: [20, 40],\n});\n\nL.tileLayer(\n  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n  {\n    attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n  },\n).addTo(map);\n\nmainPin.addTo(map);\n\nmainPin.on('moveend', (evt) => {\n  address.value = `${evt.target.getLatLng().lat.toFixed(5)}, ${evt.target.getLatLng().lng.toFixed(5)}`;\n});\n\nlet smallPins = [];\n\nconst createSmallPins = similarAds => {\n  smallPins.forEach((pin) => pin.remove());\n\n  similarAds\n    .filter(filterAds)\n    .slice(0, SIMILAR_ADS_COUNT)\n    .forEach((ad) => {\n      const smallPin = L.marker(\n        {\n          lat: ad.location.lat,\n          lng: ad.location.lng,\n        },\n        {\n          icon: smallPinIcon,\n        },\n      );\n\n      smallPin\n        .addTo(map)\n        .bindPopup(createSimilarCard(ad));\n\n      smallPins.push(smallPin);\n    });\n};\n\ngetData((ads) => {\n  createSmallPins(ads);\n  setFilterReset(() => createSmallPins(ads));\n  setFilterChange(_.debounce(\n    () => createSmallPins(ads),\n    CREATE_PINS_DELAY,\n  ));\n}, showAlert);\n\nexport {initialCoordinates, mainPin};\n"],"sourceRoot":""}